import pandas as pd

# Define the key columns and the specified status
key_columns = ['ID', 'Step']
specified_status = 'Completed'

# Read the input CSV file with '!' as the delimiter
input_file = 'input_data.csv'  # Replace with your CSV file path
df = pd.read_csv(input_file, sep='!')

# Filter records where only one step exists with the specified status
filtered_df = df[df['Status'] == specified_status].groupby(key_columns).filter(lambda x: len(x) == 1)

# Save the filtered results to a new CSV file (optional)
output_file = 'filtered_output.csv'  # Replace with your desired output file path
filtered_df.to_csv(output_file, sep='!', index=False)

# Validation: Confirm that each key combination has only one row with the specified status
validation = filtered_df.groupby(key_columns).size().reset_index(name='Count')
invalid_records = validation[validation['Count'] != 1]

if invalid_records.empty:
    print("Validation passed: Each key combination has only one row with the specified status.")
else:
    print("Validation failed: The following key combinations have more than one row:")
    print(invalid_records)