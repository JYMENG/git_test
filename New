import csv

# File paths
file1_path = 'file1.csv'  # Input file 1 (contains User and Path)
file2_path = 'file2.csv'  # Input file 2 (contains Name and ID)
output_path = 'output.csv'  # Output file

# Step 1: Extract User and Path from File 1
file1_data = []  # Store rows with User and Path columns
with open(file1_path, 'r') as file1:
    reader = csv.reader(file1, delimiter=',')  # Adjust delimiter if needed
    header1 = next(reader)  # Read the header row

    # Get indices of User and Path columns
    user_index = header1.index('User')
    path_index = header1.index('Path')

    for row in reader:
        # Keep only User and Path columns
        file1_data.append((row[user_index].strip().lower(), row[path_index].strip()))  # Normalize User to lowercase

# Step 2: Extract unique Name and ID from File 2
file2_data = {}  # Dictionary to store unique Name -> ID mappings
with open(file2_path, 'r') as file2:
    reader = csv.reader(file2, delimiter=',')  # Adjust delimiter if needed
    header2 = next(reader)  # Read the header row

    # Get indices of Name and ID columns
    name_index = header2.index('Name')
    id_index = header2.index('ID')

    for row in reader:
        # Normalize Name to lowercase and keep unique Name -> ID mapping
        name_lower = row[name_index].strip().lower()
        id_value = row[id_index].strip()
        if name_lower not in file2_data:
            file2_data[name_lower] = id_value

# Step 3: Perform an inner join on User (File 1) and Name (File 2)
output_rows = []  # Store the resulting rows
output_rows.append(['User', 'Path', 'ID'])  # Header for the output file

for user, path in file1_data:
    if user in file2_data:  # Check if User exists in File 2 data
        output_rows.append([user, path, file2_data[user]])

# Step 4: Write the output file
with open(output_path, 'w', newline='') as output_file:
    writer = csv.writer(output_file, delimiter=',')  # Adjust delimiter if needed
    writer.writerows(output_rows)

print(f"Joined records written to {output_path}")