import pandas as pd
import os

folder_path = 'path/to/your/folder'

key_column_1 = 'YourKeyColumn1'
key_value_1 = 'YourKeyValue1'

key_column_2 = 'YourKeyColumn2'
key_value_2 = 'YourKeyValue2'

key_column_3 = 'YourKeyColumn3'
key_value_3 = 'YourKeyValue3'

filtered_data = []

for file_name in os.listdir(folder_path):
    if file_name.endswith('.xls') or file_name.endswith('.htm'):
        file_path = os.path.join(folder_path, file_name)
        
        # Read the Excel file
        df = pd.read_html(file_path)[0]  # Use pd.read_html to read .htm format
        
        # Print columns to check available columns in the DataFrame
        print(f"Columns in {file_name}: {df.columns.tolist()}")
        
        try:
            # Filter the DataFrame by the three key values
            filtered_df = df[(df[key_column_1] == key_value_1) &
                             (df[key_column_2] == key_value_2) &
                             (df[key_column_3] == key_value_3)]
            
            if not filtered_df.empty:
                filtered_data.append(filtered_df)
        except KeyError as e:
            print(f"KeyError: {e} in file {file_name}")

if filtered_data:
    combined_df = pd.concat(filtered_data, ignore_index=True)
    output_file = 'combined_output.xlsx'
    combined_df.to_excel(output_file, index=False)
    print(f"Combined data saved to {output_file}")
else:
    print("No data was combined.")