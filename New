Option Explicit

Sub ImportPDFFiles()
    Dim ws As Worksheet
    Dim pdfFolder As String
    Dim fileName As String
    Dim lastRow As Long
    Dim i As Long
    
    ' Define worksheet
    Set ws = ThisWorkbook.Sheets("PDF_List") ' Change to the correct sheet name
    
    ' Clear old list
    ws.Cells.Clear
    
    ' Set folder path (Change this to your PDF folder)
    pdfFolder = "C:\Your\PDF\Folder\" ' Ensure it ends with a "\"
    
    ' Debug message
    Debug.Print "Scanning folder: " & pdfFolder
    
    ' Get first PDF file
    fileName = Dir(pdfFolder & "*.pdf")
    
    ' Check if folder contains PDFs
    If fileName = "" Then
        MsgBox "No PDF files found in the folder!", vbExclamation
        Exit Sub
    End If
    
    ' List PDF files in sheet
    i = 1
    Do While fileName <> ""
        ws.Cells(i, 1).Value = pdfFolder & fileName ' Store full path
        Debug.Print "Found file: " & fileName
        i = i + 1
        fileName = Dir
    Loop
    
    ' Get last row
    lastRow = ws.Cells(Rows.Count, 1).End(xlUp).Row
    
    ' Process each PDF
    For i = 1 To lastRow
        Debug.Print "Importing: " & ws.Cells(i, 1).Value
        ImportPDF ws.Cells(i, 1).Value
    Next i
    
    ' Mark completion
    ws.Cells(lastRow + 2, 1).Value = "FINISHED"
    Debug.Print "Processing complete!"
    
    MsgBox "All PDF files have been processed!", vbInformation
End Sub

Sub ImportPDF(pdfPath As String)
    Dim queryName As String
    Dim ws As Worksheet
    Dim tableName As String
    
    ' Define sheet to store imported data
    Set ws = ThisWorkbook.Sheets("PDF_Data") ' Change to your data sheet
    
    ' Debug message
    Debug.Print "Reading PDF: " & pdfPath
    
    ' Remove existing query if it exists
    On Error Resume Next
    queryName = "PDFImportQuery"
    ThisWorkbook.Queries(queryName).Delete
    On Error GoTo 0
    
    ' Use Power Query to import PDF
    With ActiveSheet.ListObjects.Add(SourceType:=0, Source:= _
        "OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=" & pdfPath, _
        Destination:=ws.Range("A1"))
        .Name = "PDFImportTable"
    End With
    
    ' Debug message
    Debug.Print "PDF imported: " & pdfPath
    
    ' Call processing function
    ProcessPDFData
    
End Sub

Sub ProcessPDFData()
    ' Add your data processing steps here
    
    ' Debug message
    Debug.Print "Processing imported data..."
    
    ' Example: Sort data in ascending order
    On Error Resume Next
    ActiveSheet.Range("A1").Sort Key1:=ActiveSheet.Range("A2"), Order1:=xlAscending, Header:=xlYes
    On Error GoTo 0
    
    ' Debug message
    Debug.Print "Data processing complete."
End Sub