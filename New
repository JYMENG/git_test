import pandas as pd
import numpy as np

# Sample DataFrame
df = pd.DataFrame({
    'key1': ['A', 'A', 'A', 'B', 'B', 'B'],
    'key2': [1, 1, 1, 2, 2, 2],
    'col1': ['blueberry', 'redberry', 'bluebell', 'bluefish', 'greenapple', 'bluejay'],
    'col2': ['bluefish', 'redfish', 'bluejay', 'blueberry', 'greenberry', 'blueberry'],
    'col3': [5, 6, 7, 8, 9, 10]
})

# Define the target substring
target_substring = 'blue'

# Function to assign col4 based on the condition
def assign_col4(group):
    # Identify rows where both col1 and col2 start with 'blue'
    mask = group['col1'].str.startswith(target_substring) & group['col2'].str.startswith(target_substring)
    if mask.any():
        # Get the value of col3 from the matched row
        col3_value = group.loc[mask, 'col3'].iloc[0]
        # Assign this value to col4 for all rows in the group
        group['col4'] = col3_value
    else:
        # If no match, set col4 to NaN or another default value
        group['col4'] = np.nan
    return group

# Apply the function to each group
df = df.groupby(['key1', 'key2'], group_keys=False).apply(assign_col4)

print(df)