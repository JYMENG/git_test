import pandas as pd
import json

# Step 1: Read the Excel file
df = pd.read_excel("data.xlsx")

# Step 2: Ensure the JSON column is a string and parse it
df["json_column"] = df["json_column"].astype(str)
df["parsed_json"] = df["json_column"].apply(
    lambda x: json.loads(x) if isinstance(x, str) and x.strip().startswith("{") else {}
)

# Step 3: Convert the parsed_json Series into a list and normalize it
json_list = df["parsed_json"].tolist()
df_expanded = pd.json_normalize(json_list)

# Step 4: Drop the original JSON columns and merge the expanded JSON columns
df_final = df.drop(columns=["json_column", "parsed_json"]).join(df_expanded)

# Step 5: Write the final DataFrame to a new Excel file
df_final.to_excel("processed_data.xlsx", index=False)
print("Excel file saved as processed_data.xlsx")