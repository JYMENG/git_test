import pandas as pd

# Sample DataFrame
# df = pd.DataFrame({
#     'A': [...],
#     'B': [...],
#     'C': [...],
#     'D': [...]
# })

def custom_select(group):
    has_A = group[group['C'] == 'A']
    if not has_A.empty:
        return has_A['D'].min()
    else:
        return group['D'].max()

result = df.groupby(['A', 'B'], as_index=False).apply(custom_select).reset_index()
result.columns = ['A', 'B', 'value']