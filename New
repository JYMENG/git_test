Sub UnpivotAllWorksheets()
    Dim ws As Worksheet
    Dim newWs As Worksheet
    Dim outputRow As Long
    Dim lastRow As Long, lastCol As Long
    Dim r As Long, c As Long
    
    ' Add a new worksheet for the unpivoted data
    On Error Resume Next
    Set newWs = Worksheets("Unpivoted Data")
    On Error GoTo 0
    If newWs Is Nothing Then
        Set newWs = Worksheets.Add
        newWs.Name = "Unpivoted Data"
    End If
    
    ' Clear the existing data in the "Unpivoted Data" sheet
    newWs.Cells.Clear
    
    ' Write headers in the "Unpivoted Data" sheet
    newWs.Cells(1, 1).Value = "Worksheet Name"
    newWs.Cells(1, 2).Value = "Column"
    newWs.Cells(1, 3).Value = "Row"
    newWs.Cells(1, 4).Value = "Value"
    
    outputRow = 2 ' Start writing from the second row
    
    ' Loop through each worksheet
    For Each ws In ThisWorkbook.Worksheets
        If ws.Name <> "Unpivoted Data" Then
            lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
            lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
            
            ' Loop through each cell in the worksheet
            For r = 1 To lastRow
                For c = 1 To lastCol
                    newWs.Cells(outputRow, 1).Value = ws.Name
                    newWs.Cells(outputRow, 2).Value = ws.Cells(1, c).Value
                    newWs.Cells(outputRow, 3).Value = ws.Cells(r, 1).Value
                    newWs.Cells(outputRow, 4).Value = ws.Cells(r, c).Value
                    outputRow = outputRow + 1
                Next c
            Next r
        End If
    Next ws
    
    MsgBox "Unpivoting complete!", vbInformation
End Sub
