import csv
from datetime import datetime

input_file = 'your_large_file.csv'
output_file = 'filtered_output.csv'

key_list = set([101, 202, 303])  # as integers
start_date = datetime.strptime('2023-01-01', '%Y-%m-%d')
end_date = datetime.strptime('2024-12-31', '%Y-%m-%d')

with open(input_file, 'r', encoding='utf-8') as fin, open(output_file, 'w', encoding='utf-8') as fout:
    for line in fin:
        raw_line = line.strip()
        if not raw_line:
            continue  # skip empty lines

        # Get first field before first comma
        first_field = raw_line.split(',', 1)[0].strip()

        keep = False

        # Try as int for key match
        try:
            if int(first_field) in key_list:
                keep = True
        except ValueError:
            pass

        # Try as date
        try:
            dt = datetime.strptime(first_field, '%Y-%m-%d')
            if start_date <= dt <= end_date:
                keep = True
        except ValueError:
            pass

        if keep:
            fout.write(line)