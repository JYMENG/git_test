import os

# Root folder path
root_dir = '/path/to/your/folder'
output_file = 'combined_output.csv'

# Collect and sort files by descending folder path
html_files = []
for dirpath, _, filenames in os.walk(root_dir):
    for fname in filenames:
        if fname.lower().endswith(('.htm', '.html')):
            html_files.append(os.path.join(dirpath, fname))

# Sort by descending subfolder
html_files = sorted(html_files, key=lambda x: os.path.dirname(x), reverse=True)

seen_lines = set()
header_written = False

with open(output_file, 'w', encoding='utf-8') as out_f:
    for file_path in html_files:
        with open(file_path, 'r', encoding='utf-8', errors='ignore') as in_f:
            for line_no, line in enumerate(in_f):
                clean_line = line.strip()
                if not clean_line:
                    continue

                # Drop first column (split by comma or whitespace, as needed)
                parts = clean_line.split(',')
                if len(parts) < 2:
                    continue  # Skip lines that are too short
                line_wo_first_col = ','.join(parts[1:])

                # Handle header from the first file only
                if line_no == 0 and not header_written:
                    out_f.write(line_wo_first_col + '\n')
                    header_written = True
                    continue
                elif line_no == 0:
                    continue  # skip headers in other files

                # Deduplicate
                if line_wo_first_col not in seen_lines:
                    out_f.write(line_wo_first_col + '\n')
                    seen_lines.add(line_wo_first_col)

print(f"\nâœ… Combined CSV written to: {output_file}")