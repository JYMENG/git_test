import csv

# File paths
file1_path = 'file1.csv'
file2_path = 'file2.csv'
output_path = 'all_matched_records.csv'

# Step 1: Read users from file2.csv into a set
valid_users = set()
with open(file2_path, 'r') as file2:
    reader = csv.reader(file2)
    header = next(reader)  # Skip the header if present
    for row in reader:
        valid_users.add(row[0])  # Assuming 'User' is in the first column

# Step 2: Find matched Record_IDs based on Manager 1 or Manager 2
matched_record_ids = set()
with open(file1_path, 'r') as file1:
    reader = csv.reader(file1)
    header = next(reader)  # Skip the header
    for row in reader:
        if row[1] in valid_users or row[2] in valid_users:  # Manager 1 or Manager 2 match
            matched_record_ids.add(row[0])  # Collect the Record_ID

# Step 3: Extract all records from file1 with matched Record_IDs
all_matched_records = []
with open(file1_path, 'r') as file1:
    reader = csv.reader(file1)
    header = next(reader)  # Read the header
    all_matched_records.append(header)  # Include header in the output
    for row in reader:
        if row[0] in matched_record_ids:  # Check if Record_ID matches
            all_matched_records.append(row)

# Step 4: Write all matched records to a new file
with open(output_path, 'w', newline='') as output_file:
    writer = csv.writer(output_file)
    writer.writerows(all_matched_records)

print(f"All matched records written to {output_path}")