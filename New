from pathlib import Path
from bs4 import BeautifulSoup

def merge_htm_to_text(input_folder, output_file, encoding="utf-8-sig"):
    folder_path = Path(input_folder)
    files = sorted(list(folder_path.glob("*.htm")) + list(folder_path.glob("*.html")))
    if not files:
        raise FileNotFoundError(f"No .htm/.html files found in {folder_path}")

    with open(output_file, "w", encoding=encoding) as out_f:
        for file in files:
            try:
                html_content = file.read_text(encoding=encoding, errors="replace")
                soup = BeautifulSoup(html_content, "html.parser")
                text = soup.get_text(separator="\n")  # get only visible text
                # Strip excessive blank lines
                cleaned_lines = [line.strip() for line in text.splitlines() if line.strip()]
                out_f.write("\n".join(cleaned_lines) + "\n")
            except Exception as e:
                print(f"[WARN] Skipped {file.name}: {e}")

    print(f"Done. Wrote plain text from {len(files)} files into {output_file}")

# Example usage:
merge_htm_to_text(
    input_folder=r"C:\path\to\your\folder",
    output_file=r"C:\path\to\output\merged.txt"
)