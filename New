import pandas as pd
import os

# Define the folder containing the .xls files
folder_path = 'path/to/your/folder'

# Define the key value to filter by
key_column = 'YourKeyColumn'  # Replace with the column name to filter by
key_value = 'YourKeyValue'    # Replace with the value to filter by

# Create an empty list to store filtered DataFrames
filtered_data = []

# Loop through each file in the folder
for file_name in os.listdir(folder_path):
    if file_name.endswith('.xls') or file_name.endswith('.htm'):
        file_path = os.path.join(folder_path, file_name)
        
        # Read the Excel file
        df = pd.read_html(file_path)[0]  # Use pd.read_html to read .htm format
        
        # Filter the DataFrame by the key value
        filtered_df = df[df[key_column] == key_value]
        
        if not filtered_df.empty:
            # Add the filtered DataFrame to the list
            filtered_data.append(filtered_df)

# Combine all filtered DataFrames into one
combined_df = pd.concat(filtered_data, ignore_index=True)

# Write the combined DataFrame to a new .xlsx file
output_file = 'combined_output.xlsx'
combined_df.to_excel(output_file, index=False)

print(f"Combined data saved to {output_file}")